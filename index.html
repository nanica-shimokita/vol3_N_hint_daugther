<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪盗Nと美術館だらけの町　ヒント</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="怪盗Nと美術館だらけの町 ヒント">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
      .reload-container { position: absolute; top: 15px; right: 15px; z-index: 100; }
      .reload-button { background: #fff; border: 1px solid #ccc; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666; padding: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
      .reload-button:active { background-color: #eee; transform: rotate(90deg); transition: 0.2s; }
      .accordion.is-locked { display: none !important; }
    </style>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function() { navigator.serviceWorker.register("./sw.js"); });
      }
      function reloadPage() { location.reload(true); }

      async function checkAutoUnlock() {
        try {
          // GASのdoGetから直接ステータスを取得（即時反映用）
          const response = await fetch("https://script.google.com/macros/s/AKfycbwG9LOTmQhrNLK58Na7hw-qc6eBuFAd0at4J2jAU0ek/dev?t=" + Date.now());
          if (!response.ok) return;
          const statusList = await response.json();
          
          // 全アコーディオンに対して公開状態を反映
          statusList.forEach(item => {
            document.querySelectorAll(".accordion.is-locked").forEach(acc => {
              const nameSpan = acc.querySelector(".hint-name");
              if (nameSpan && nameSpan.innerText.trim() === item.name) {
                if (item.status === true) acc.classList.remove("is-locked");
              }
            });
          });
        } catch (e) { console.error("Update check failed", e); }
      }
      setInterval(checkAutoUnlock, 5000);
    </script>
</head>
<body>
    <div class="container" style="position: relative;">
        <div id="start-screen">
            <h1>怪盗Nと美術館だらけの町</h1>
            <p>チームメンバー全員の合意を得てから読み進めましょう。</p>
            <button id="show-hint-button">ヒントを見る</button>
        </div>
        <div id="hint-content" style="display: none;">
            <div class="reload-container">
              <button class="reload-button" onclick="reloadPage()" title="再読み込み">↻</button>
            </div>
            <h1>怪盗Nと美術館だらけの町　ヒント</h1>
            <div class="hint-time-guidelines">
                <p class="guideline-heading">ヒントが表示されない場合は右上リロードボタンを押してください</p>
            </div>
            <div class="accordion level-1"><div class="accordion-header"><span class="hint-name">クイン・ミュージアム</span></div><div class="accordion-content"><div class="hint-body"><p></p></div><div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">潜入の謎</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
<div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">その先</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
</div></div>
<div class="accordion level-1"><div class="accordion-header"><span class="hint-name">パルズ・ミュージアム</span></div><div class="accordion-content"><div class="hint-body"><p></p></div><div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">潜入の謎</span></div><div class="accordion-content"><div class="hint-body"><p></p></div><div class="accordion inner-accordion level-3"><div class="accordion-header"><span class="hint-name">その先</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
</div></div>
</div></div>
<div class="accordion level-1"><div class="accordion-header"><span class="hint-name">ムール・ミュージアム</span></div><div class="accordion-content"><div class="hint-body"><p></p></div><div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">潜入の謎</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
<div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">その先</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
</div></div>
<div class="accordion level-1"><div class="accordion-header"><span class="hint-name">ロリン・ミュージム</span></div><div class="accordion-content"><div class="hint-body"><p></p></div><div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">潜入の謎</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
<div class="accordion inner-accordion level-2"><div class="accordion-header"><span class="hint-name">その先</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
</div></div>
<div class="accordion level-1"><div class="accordion-header"><span class="hint-name">フェルラントのアトリエ</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>
<div class="accordion level-1"><div class="accordion-header"><span class="hint-name">フェルラントの最高傑作</span></div><div class="accordion-content"><div class="hint-body"><p></p></div></div></div>

        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>